<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ãƒšãƒ¼ã‚¸</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 id="event-name-title">ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†</h1>

        <div class="url-box">
            <p>ğŸ”— å…±æœ‰ç”¨URL</p>
            <p><strong>ã€æ¥å ´è€…å‘ã‘ã€‘é–²è¦§ç”¨URL</strong><br>ã“ã®URLã‚’æ¥å ´è€…ã«å…±æœ‰ã—ã¦ãã ã•ã„ã€‚</p>
            <a id="public-url" href="" target="_blank"></a>
            <p style="margin-top: 15px;"><strong>ã€ä¸»å‚¬è€…ãƒ»å‡ºåº—è€…å‘ã‘ã€‘ç®¡ç†ç”¨URL</strong><br>ã“ã®ãƒšãƒ¼ã‚¸ã§ã™ã€‚ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
            <a id="admin-url" href=""></a>
        </div>
        
        <h2>å‡ºåº—ã‚’ç™»éŒ²ã™ã‚‹</h2>
        <input type="text" id="boothName" placeholder="å‡ºåº—åï¼ˆä¾‹ï¼šã‚„ããã°å±‹ï¼‰">
        <input type="text" id="location" placeholder="å ´æ‰€ï¼ˆä¾‹ï¼šä½“è‚²é¤¨å‰ï¼‰">
        <button onclick="addBooth()">å‡ºåº—ã‚’ç™»éŒ²</button>

        <h2>ç™»éŒ²æ¸ˆã¿ã®å‡ºåº—ä¸€è¦§</h2>
        <ul id="booth-list">
            </ul>
    </div>

    <script>
        const adminId = new URLSearchParams(window.location.search).get('adminId');

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ãƒ»è¡¨ç¤º
        window.onload = async () => {
            if (!adminId) {
                document.body.innerHTML = '<h1>ç„¡åŠ¹ãªã‚¢ã‚¯ã‚»ã‚¹ã§ã™</h1>';
                return;
            }
            fetchAndRenderBooths();
        };

        async function fetchAndRenderBooths() {
            const response = await fetch(`/api/manage/${adminId}`);
            if (!response.ok) {
                document.body.innerHTML = '<h1>ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h1>';
                return;
            }

            const eventData = await response.json();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆåã‚’è¨­å®š
            document.getElementById('event-name-title').textContent = `ã€${eventData.eventName}ã€‘ç®¡ç†è€…ãƒšãƒ¼ã‚¸`;
            
            // URLã‚’è¨­å®š
            const publicUrl = `${window.location.origin}/view.html?publicId=${eventData.publicId}`;
            document.getElementById('public-url').href = publicUrl;
            document.getElementById('public-url').textContent = publicUrl;

            const adminUrl = window.location.href;
            document.getElementById('admin-url').href = adminUrl;
            document.getElementById('admin-url').textContent = adminUrl;


            // å‡ºåº—ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            const listElement = document.getElementById('booth-list');
            listElement.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
            if (eventData.booths.length === 0) {
                listElement.innerHTML = '<p>ã¾ã å‡ºåº—ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
            } else {
                eventData.booths.forEach(booth => {
                    const li = document.createElement('li');
                    const boothUrl = `${window.location.origin}/booth.html?boothId=${booth.id}`;
                    li.innerHTML = `
                        <div>
                            <strong>${booth.name}</strong> (${booth.location})<br>
                            <small>æ··é›‘åº¦æ›´æ–°ç”¨URL: <a href="${boothUrl}" target="_blank">${boothUrl}</a></small>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }
        }

        async function addBooth() {
            const boothName = document.getElementById('boothName').value;
            const location = document.getElementById('location').value;

            if (!boothName || !location) {
                alert('å‡ºåº—åã¨å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const response = await fetch(`/api/events/${adminId}/booths`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ boothName, location })
            });

            if (response.ok) {
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('boothName').value = '';
                document.getElementById('location').value = '';
                // ãƒªã‚¹ãƒˆã‚’å†æç”»
                fetchAndRenderBooths();
            } else {
                alert('å‡ºåº—ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }
    </script>
</body>
</html>